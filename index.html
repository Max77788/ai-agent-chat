<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat with URL-param messages</title>
    <link
      href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      body {
        display: flex;
        flex-direction: column;
      }
      #chat-wrapper {
        flex: 1;
        position: relative;
        width: 100%;
        height: 100%;
      }
      #my-chat {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="chat-wrapper">
      <div id="my-chat"></div>
    </div>

    <script type="module">
      function getUrlParam(key) {
        const params = new URLSearchParams(window.location.search);
        return params.get(key);
      }

      // Capitalize each word in a string
      function capitalizeName(str) {
        if (!str) return "";
        return str
          .split(" ")
          .map((word) => {
            return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
          })
          .join(" ");
      }

      const userName = capitalizeName(getUrlParam("name")) || "";
      const userId = getUrlParam("uid") || "";

      import { createChat } from "https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js";

      const initialGreeting = userName
        ? `Hello, ${userName}! How can I help you today in your fitness journeyðŸ’ª?`
        : "Hello! How can I help you today in your fitness journeyðŸ’ª?";

      createChat({
        webhookUrl:
          "https://stoneinvest.app.n8n.cloud/webhook/24d97590-c0c7-453c-b56e-3191e2560fad/chat",
        target: "#my-chat",
        mode: "fullscreen",
        showWelcomeScreen: false,
        initialMessages: [initialGreeting],
        i18n: {
          en: {
            title: userName ? `Hi, ${userName}ðŸ‘‹` : "Hi there! ðŸ‘‹",
            subtitle: `Start a chat with ${userName}'s personal virtual assistant.`,
            footer: "",
            getStarted: "New Conversation",
            inputPlaceholder: "Type your message..",
          },
        },
        metadata: {
          name: userName,
          uid: userId,
        },
        // Ensure youâ€™ve other settings as needed
      });
    </script>
  </body>
</html>
